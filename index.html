<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Magic the Gathering Arena</title>
	</head>
	<style>

	</style>
	<body>
	<div id="form">
		<textarea id="input"></textarea><br />
		<button id="submit">Send</button>
	</div>

	<div id="deck">
	</div>
	<script type="text/javascript">
		let deck = document.querySelector("div#deck");
		let form = document.querySelector("div#form");

		let button = document.querySelector("button#submit");
		let input = "";

		let request = new XMLHttpRequest();

		let iteration = 0;
		let items;

		//if request was made. Add card if possible. Then, add another if could be.
		request.onreadystatechange = () => {
			if (request.readyState == XMLHttpRequest.DONE) {
				let object = JSON.parse(request.responseText);

				let url = object.data[0].image_uris.png;
				deck.innerHTML += `<img src="${url}"></img>`;

				if (items.length - 1 != iteration) {
					iteration++;
					getCard(items[iteration]);
				}
			}
		}

		//Actually submit the form
		button.addEventListener("click", () => {
			input = document.querySelector("textarea#input").value;
			console.log(btoa(input));
			iteration = 0;
			deck.innerHTML = "";

			if (input != "") {
				items = input.split("\n")
				getCard(items[iteration]);
			}
		});

		//get JSON response
		function getCard(item) {
			item = item.replace(/\([^)]*\)/, '');
			item = item.replace(/[0-9]+/, '');
			item = item.replace(/[0-9]+/, '');
			item = item.replace(/^\s+|\s+$|\s+(?=\s)/, '');
			item = item.replace(/^\s+|\s+$|\s+(?=\s)/, '');

			request.open('GET', `https://api.scryfall.com/cards/search?order=cmc&q="${item}"`, true);
			request.send(null);
		}
	</script>
	</body>
</html>
